# CV Verification System - FTEC5660 HW2 Part1
## 1. System Architecture

The system follows a modular multi-agent pipeline. The main components are:

- **CV Parser**: Converts PDF CVs to text using `MarkItDown` and extracts structured information (name, location, education, experience, skills) via an LLM.
- **Facebook Agent**: Searches Facebook via MCP tools, retrieves profiles, and validates CV data against Facebook.
- **LinkedIn Agent**: Searches LinkedIn via MCP tools, retrieves detailed profiles, and validates CV data.
- **Report Aggregator**: Combines CV data and both social media reports into a structured `FinalReport`(matches, discrepancies, missing info, internal inconsistencies).
- **Scoring Agent**: Evaluates the aggregated report and outputs a trustworthiness score (0–1) based on predefined guidelines.
- **Evaluation Module**: Compares scores with ground truth labels to compute accuracy.

## 2. Design Decisions
### 2.1 Multi-Agent
The system is decomposed into several specialized agents to manage complexity and improve maintainability.

### 2.2 Search Strategies for Each Platform
The MCP tools impose different constraints, and this design respects them while maximizing match quality:
- **Facebook Search**: The `search_facebook_users` tool accepts only `q` (name), `limit`, and `fuzzy`; `location` is not a parameter. The agent filters candidates by examining `city`/`country` in the results. This avoids tool‑call errors and lets the LLM choose the most plausible profile based on CV location hints.
- **LinkedIn Search**: Although `earch_linkedin_people` accepts a location parameter, we deliberately omit it. CVs often list multiple locations, and separate searches would increase tool calls. Instead, the agent relies on `headline` and `industry` to pick the best match from a name‑only search.
- **Fallback**: Both agents must select the most similar profile (even if imperfect) rather than giving up, ensuring every CV receives an assessment.

### 2.3 Classification
Discrepancies are not binary. We introduce three severity levels to help the scoring agent weigh them appropriately:
- **High**: Complete mismatch in company, education level (PhD vs MSc), or different schools. These strongly undermine trust.
- **Low**: Slight title variations (Senior Engineer vs Engineer), generic degree descriptions (BSc vs BSc in Engineering), and so on.
- **Acceptable**: Exact matches, or support from at least one platform even if the other is missing/slightly off.

The severity labels are used by the scoring agent to compute the final score, ensuring that a CV with only minor issues still receives a high score (e.g., CV_3).

### 2.4 Scoring Guidelines
The scoring agent uses a 0–1 scale with thresholds:
- **0.8–1.0**: Highly consistent with at least one social profile.
- **0.51–0.79**: Acceptable alignment in core education and experience.
- **0.0–0.49**: Severe contradictions with both platforms.

## 3. Agent Workflow and Tool Usage Strategy

<img src="assets/Agent_Workflow.jpeg" alt="Agent_Workflow" width="35%"> 
This image was generated by deepseek.

### 3.1 Facebook Agent
The Facebook verification agent is responsible for locating the candidate’s Facebook presence and assessing how well it matches the CV. 
- **Name‑only search**: The agent first invokes `search_facebook_users` with the candidate’s name, a high result limit (`20`), and fuzzy matching enabled. This returns a list of potential profiles, each containing `display_name`, `city`, `country`, and a unique `id`.
- **Location‑based filtering**: Since the search API does not accept a location parameter, the agent examines the `city` and `country` fields of the returned results and selects the profile(s) whose location aligns best with the location mentioned in the CV. This step is performed by the LLM, which can reason about partial matches (e.g., “Singapore” vs. “Singapore, Singapore”).
- **Profile retrieval**: For the most relevant candidate(s), the agent calls `get_facebook_profile` to obtain a detailed profile.
- **Mismatch classification**: LLM compares CV fields (title, company, education, skills) against profile data, labeling discrepancies as **High or Low**.
- **Report generation**: Outputs a plain‑text report with confidence level (high/medium/low/none), matched/mismatched fields, and summary.

### 3.2 LinkedIn Agent
- **Search without location**: `search_linkedin_people(q=name, limit=5)` → candidates with `headline`, `industry`, `id`.
- **Headline analysis**: From the returned profiles, the LLM selects the best‑matching candidates by comparing the `headline` (e.g., “Senior Software Engineer at Google”) with the candidate’s current title and industry extracted from the CV.
- **Detailed profile retrieval**: For the selected profile(s), the agent invokes `get_linkedin_profile` to obtain a complete record, including work experience, education, and a list of skills with proficiency levels.
- **Field‑by‑field verification**: The agent then systematically compares the CV’s experience entries, education, and skills against the LinkedIn data.
- **Report generation**: The outcome is formatted identically to the Facebook report, with a match confidence, detailed lists of matched/mismatched/uncertain fields, and a summary.

### 3.3 Report Aggregator
The aggregator (LLM) synthesizes CV data and both social reports into a `FinalReport`:
- **Identifying matches**: Any field that is supported by **at least one** social media profile (Facebook or LinkedIn) is recorded as a `key_match`. This embodies the “either‑platform‑is‑sufficient” philosophy, preventing false negatives when one platform is incomplete.
- **Flagging discrepancies**: A discrepancy is recorded **only** when the CV’s claim contradicts **both** social profiles. For example, if the CV says “PhD in Computer Science” but LinkedIn shows “MSc” and Facebook shows no education, this becomes a `key_discrepancy` with severity “major”.
- **Noting missing information**: If an entire experience entry or a skill set appears in the CV but is absent from both Facebook and LinkedIn, it is added to `key_missing`.
- **Incorporating internal inconsistencies**: The `internal_inconsistent` list generated during CV parsing is mapped to `internal_consistency` items, providing a holistic view of the CV’s self‑consistency.
- **Marking uncertain fields**: Fields where the social data is ambiguous (e.g., a generic “Bachelor’s Degree” on Facebook vs a specific degree on the CV) are placed in `uncertains`.

The final output is a JSON‑serializable object conforming to the `Report` model, which includes a high‑level `risk_level` (low/medium/high) and a human‑readable `summary`.

### 3.4 Scoring Agent
The scoring agent takes the aggregated report (as JSON) and outputs a single float (0–1) following the guidelines in 2.4. It returns only the numeric value.

## 4. Sample Verification Results

The system was tested on the five provided CVs. The final results are summarized below:

| CV        | Name          | Risk Level | Score (0–1) | Ground Truth | Correct? |
|-----------|---------------|------------|-------------|--------------|----------|
| CV_1.pdf  | John Smith    | MEDIUM     | 0.65        | 1 (pass)     | Yes      |
| CV_2.pdf  | Minh Pham     | MEDIUM     | 0.60        | 1 (pass)     | Yes      |
| CV_3.pdf  | Wei Zhang     | LOW        | 0.90        | 1 (pass)     | Yes      |
| CV_4.pdf  | Rahul Sharma  | HIGH       | 0.10        | 0 (reject)   | Yes      |
| CV_5.pdf  | Rahul Sharma  | HIGH       | 0.10        | 0 (reject)   | Yes      |


CV VERIFICATION RESULTS(Plain Text Summary):
```
CV_1.pdf - John Smith
  Risk Level  : MEDIUM
  Final Score : 0.65 (0-1)
  Summary     : The candidate's CV largely aligns with their LinkedIn profile, providing strong verification for most details including name, location, current title, education, and skills. However, Facebook shows se...
------------------------------------------------------------

CV_2.pdf - Minh Pham
  Risk Level  : MEDIUM
  Final Score : 0.6 (0-1)
  Summary     : The candidate's CV largely aligns with their LinkedIn profile, confirming key details such as name, location, current and previous employment (company, title, dates), education, and skills. However, t...
------------------------------------------------------------

CV_3.pdf - Wei Zhang
  Risk Level  : LOW
  Final Score : 0.9 (0-1)
  Summary     : The candidate's profile shows strong consistency across CV and LinkedIn for name, location (Munich, Germany), current title, company, education institution, and graduation year. While the CV states cu...
------------------------------------------------------------

CV_4.pdf - Rahul Sharma
  Risk Level  : HIGH
  Final Score : 0.1 (0-1)
  Summary     : The verification report for Rahul Sharma reveals significant discrepancies between the CV and information found on Facebook and LinkedIn. While the name and one of the listed locations (Singapore) are...
------------------------------------------------------------

CV_5.pdf - Rahul Sharma
  Risk Level  : HIGH
  Final Score : 0.1 (0-1)
  Summary     : The verification report for Rahul Sharma reveals significant discrepancies between the CV and the social media profiles (Facebook and LinkedIn). While the name and general location are consistent, the...
------------------------------------------------------------
```

The evaluation function with threshold 0.5 produced:
```
{'decisions': [1, 1, 1, 0, 0], 'correct': 5, 'total': 5, 'final_score': 1.0}
```
This system achieved **100% accuracy** on the sample set.
